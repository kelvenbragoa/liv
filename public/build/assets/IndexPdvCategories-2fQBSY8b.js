import{s as ge}from"./index-COqPftqn.js";import{s as _e}from"./index-qXUTzdOx.js";import{s as xe}from"./index-CORwN7jQ.js";import{s as he,a as we,b as ke}from"./index-Cvu2dNwT.js";import{s as Ce,a as Te}from"./index-BDfkQj70.js";import{s as De}from"./index-BUxeSNZt.js";import{s as $e}from"./index-BTpf2uCp.js";import{u as Me,r as l,w as Re,b as Ue,c as n,d as t,a as o,g as T,t as r,l as F,F as f,a1 as g,e as u,o as i,k as N,M as je,aV as Pe,i as Se}from"./app-vYUSM3WH.js";import{d as Be}from"./moment-CQ1ixRO1.js";import"./index-CANkx4T-.js";import"./index-HUIxTbDJ.js";import"./index-DhWyYE7j.js";import"./index-DDNpWD7N.js";import"./index-CGiVpY5D.js";import"./index-JNaSvpna.js";import"./index-CztwITzX.js";import"./index-B26h3KPN.js";import"./index-CN0qabK-.js";import"./index-SYVZSIUZ.js";import"./index-CIy5AIpj.js";import"./index-OOuWSvRy.js";const Ee={key:0,class:"flex flex-col md:flex-row gap-12 min-h-screen items-center justify-center"},Le={class:"w-full"},qe={class:"flex flex-col gap-4 text-center"},Fe={key:1},Ne={class:"grid grid-cols-12 gap-4 h-screen"},Ve={class:"col-span-12 lg:col-span-3 h-full"},Oe={class:"card flex flex-col gap-4 h-full"},Ie={key:0},Ae=["onClick"],Ze={class:"flex justify-between mb-4"},We={key:0,class:"mt-4"},ze=["disabled"],Je={key:0,class:"flex flex-col gap-4 text-center"},He={class:"col-span-12 lg:col-span-9"},Qe={class:"mb-2"},Xe={class:"card flex flex-col gap-4"},Ge={key:0},Ke={class:"grid grid-cols-12 gap-8"},Ye={class:"card mb-0 bg-gray-100"},et={class:"mb-4"},tt=["src"],st={class:"flex justify-between mb-4"},at={class:"text-surface-900 dark:text-surface-0 font-medium text-xl"},lt={class:"flex justify-between mb-4"},ot={class:"text-primary font-medium"},it=["onClick"],nt={key:1},rt={class:"p-4"},ut={class:"space-y-2"},dt=["onClick"],ct={class:"mt-4 text-lg font-semibold"},pt={class:"text-blue-500"},vt={class:"mt-4 flex justify-end"},mt={class:"p-4"},ft={class:"mt-4 flex justify-end space-x-2"},bt={class:"p-4"},yt={class:"space-y-2"},gt={class:"mt-4 text-lg font-semibold"},_t={class:"text-blue-500"},xt={class:"mt-4 flex justify-end"},ht={class:"p-4"},wt={class:"space-y-2"},kt={class:"mt-4 text-lg font-semibold"},Ct={class:"text-blue-500"},Tt={class:"mt-4 flex justify-end"},Dt=["src"],$t="13579",Gt={__name:"IndexPdvCategories",setup(Mt){const _=Se(),c=Me();l(null);const S=l(!0),V=l(!1);let J=l(null);const H=l(""),B=l(null),se=l(1);l(15),l(0);const O=l(!1),E=l(null),D=l([]),$=l(0),M=l(0),v=l(!1),R=l([]),ae=l(!1),U=l(1),I=l([]),Q=l(null),A=l(null),h=l(!1),x=l(null),Z=l(!1),L=l(!1),W=l(!1),q=l(!1),z=l(!1),j=l(!1),le=[{label:"Consumo",items:[{label:"Ver consumo",icon:"pi pi-fw pi-folder-open",command:()=>{L.value=!0}},{label:"Imprimir Consumo",icon:"pi pi-fw pi-print",command:()=>{ve()}}]},{label:"Conta",items:[{label:"Fechamento da Conta",icon:"pi pi-fw pi-lock",command:()=>{q.value=!0}},{label:"Finalizar da Conta",icon:"pi pi-fw pi-check",command:()=>{z.value=!0}}]}];function X(){_&&_.back()}const oe=a=>{Q.value=a,j.value=!0},ie=()=>{if(A.value!==$t){c.add({severity:"error",summary:"Erro",detail:"Código de confirmação inválido",life:3e3});return}else axios.post(`/api/orderitem/${Q.value}`).then(a=>{B.value=a.data,M.value=a.data.total_consumed,E.value=a.data.categories,R.value=a.data.order_items,I.value=a.data.payment_methods,U.value=1,j.value=!1,c.add({severity:"success",summary:"Sucesso",detail:"Sucesso ao apagar",life:3e3})}).catch(a=>{c.add({severity:"error",summary:"Erro",detail:`${a}`,life:3e3})}).finally(()=>{})},G=()=>{O.value=!1};function ne(){const a={products:D.value.map(e=>({id:e.id,name:e.name,quantity:e.quantity,total:e.price*e.quantity})),total:$.value,table_id:_.currentRoute.value.params.id};v.value=!0,axios.post("/api/pdv",a,{headers:{"Content-Type":"multipart/form-data"},responseType:"blob"}).then(e=>{ae.value=!1;const d=new Blob([e.data],{type:"application/pdf"});x.value=URL.createObjectURL(d),h.value=!0,W.value=!1,c.add({severity:"success",summary:"Successo",detail:"Produto encomedado sucesso!",life:3e3})}).catch(e=>{v.value=!1,c.add({severity:"error",summary:"Erro}",detail:`${e}`,life:3e3}),e.response.data.errors&&setErrors(e.response.data.errors)}).finally(()=>{v.value=!1})}function re(){v.value=!0,axios.get(`/api/pdv/closeaccount/${_.currentRoute.value.params.id}`,{responseType:"blob"}).then(a=>{const e=new Blob([a.data],{type:"application/pdf"});x.value=URL.createObjectURL(e),h.value=!0,q.value=!1,c.add({severity:"success",summary:"Successo",detail:"Encomenda fechada sucesso!",life:3e3})}).catch(async a=>{var d,w;v.value=!1;let e="Ocorreu um erro inesperado.";if(a.response&&a.response.data instanceof Blob)try{const b=await a.response.data.text(),y=JSON.parse(b);e=y.message||y.error||e}catch(b){console.error("Erro ao processar o blob:",b)}else(w=(d=a.response)==null?void 0:d.data)!=null&&w.message&&(e=a.response.data.message);c.add({severity:"error",summary:"Erro",detail:e,life:3e3}),a.response.data.errors&&setErrors(a.response.data.errors)}).finally(()=>{v.value=!1})}function ue(){const a={payment_method_id:U.value,table_id:_.currentRoute.value.params.id};v.value=!0,axios.post("/api/payaccount",a,{headers:{"Content-Type":"multipart/form-data"},responseType:"blob"}).then(e=>{x.value&&URL.revokeObjectURL(x.value);const d=new Blob([e.data],{type:"application/pdf"});x.value=URL.createObjectURL(d),h.value=!0,W.value=!1,c.add({severity:"success",summary:"Successo",detail:"Encomenda fechada sucesso!",life:3e3})}).catch(async e=>{var w,b;console.log(e),v.value=!1;let d="Ocorreu um erro inesperado.";if(e.response&&e.response.data instanceof Blob)try{const y=await e.response.data.text(),P=JSON.parse(y);d=P.message||P.error||d}catch(y){console.error("Erro ao processar o blob:",y)}else(b=(w=e.response)==null?void 0:w.data)!=null&&b.message&&(d=e.response.data.message);c.add({severity:"error",summary:"Erro",detail:d,life:3e3}),e.response.data.errors&&setErrors(e.response.data.errors)}).finally(()=>{v.value=!1})}function de(a){const e=D.value.find(d=>d.id===a.id);e?e.quantity+=1:D.value.push({...a,quantity:1}),K()}function ce(a){D.value.splice(a,1),K()}function K(){$.value=D.value.reduce((a,e)=>a+e.price*e.quantity,0)}function pe(){const a=document.querySelector("iframe");a&&(a.contentWindow.focus(),a.contentWindow.print())}function ve(){axios.post(`/api/getreceipt/${_.currentRoute.value.params.id}`,{},{responseType:"blob"}).then(a=>{const e=new Blob([a.data],{type:"application/pdf"});x.value=URL.createObjectURL(e),h.value=!0,W.value=!1,c.add({severity:"success",summary:"Successo",detail:"Consumo Impresso com sucesso!",life:3e3})}).catch(a=>{S.value=!1,c.add({severity:"error",summary:`${a}`,detail:"Message Detail",life:3e3}),X()})}const Y=async(a=1)=>{axios.get(`/api/pdv/${_.currentRoute.value.params.id}`,{params:{query:H.value}}).then(e=>{B.value=e.data,M.value=e.data.total_consumed,E.value=e.data.categories,R.value=e.data.order_items,I.value=e.data.payment_methods,U.value=1,S.value=!1}).catch(e=>{S.value=!1,c.add({severity:"error",summary:`${e}`,detail:"Message Detail",life:3e3}),X()})},me=()=>{V.value=!0,axios.delete(`/api/tables/${J.value}`).then(()=>{B.value.data=B.value.data.filter(a=>a.id!==J.value),G(),c.add({severity:"success",summary:"Sucesso",detail:"Sucesso ao apagar",life:3e3})}).catch(a=>{c.add({severity:"error",summary:"Erro",detail:`${a}`,life:3e3}),V.value=!1}).finally(()=>{V.value=!1})};function fe(){h.value=!0,_.back()}const be=Be(()=>{Y(se.value)},300);return Re(H,be),Ue(()=>{Y()}),(a,e)=>{const d=$e,w=De,b=we,y=ke,P=Ce,ee=Te,te=he,m=xe,k=_e,ye=ge;return i(),n(f,null,[S.value?(i(),n("div",Ee,[t("div",Le,[t("div",qe,[o(d,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"}),e[14]||(e[14]=t("p",null,"Por Favor Aguarde...",-1))])])])):(i(),n("div",Fe,[t("div",Ne,[t("div",Ve,[t("div",Oe,[t("h2",null,[e[15]||(e[15]=T("Resumo da venda ")),$.value>0?(i(),n("div",Ie,[t("strong",null,"Total: "+r($.value)+" MT",1)])):F("",!0)]),(i(!0),n(f,null,g(D.value,(s,p)=>(i(),n("div",{key:p,class:"card bg-gray-100 p-4"},[t("div",null,[t("strong",null,r(s.name),1),t("button",{onClick:C=>ce(p),class:"rounded-full bg-red-100",style:{width:"2.5rem",height:"2.5rem"}},"X",8,Ae)]),t("div",Ze,[t("div",null,r(s.quantity)+" x "+r(s.price)+" MT",1),t("div",null,r(s.price*s.quantity)+" MT",1)])]))),128)),$.value>0?(i(),n("div",We,[t("strong",null,"Total: "+r($.value)+" MT",1),t("button",{disabled:v.value,onClick:ne,class:"bg-blue-500 text-white px-4 py-2 rounded-full mt-1",style:{width:"100%"}},e[16]||(e[16]=[T("Adicionar a conta"),t("i",{class:"pi pi-print"},null,-1)]),8,ze),v.value?(i(),n("div",Je,[o(d,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"})])):F("",!0)])):F("",!0)])]),t("div",He,[t("div",Qe,[o(w,{model:le},{end:u(()=>[t("p",null,"Total Consumo: "+r(M.value)+" MT",1)]),_:1})]),t("div",Xe,[o(te,{value:1},{default:u(()=>[o(y,{class:"flex overflow-x-auto space-x-4 pb-2"},{default:u(()=>[(i(!0),n(f,null,g(E.value,s=>(i(),N(b,{key:s.id,value:s.id},{default:u(()=>[T(r(s.name),1)]),_:2},1032,["value"]))),128))]),_:1}),o(ee,null,{default:u(()=>[(i(!0),n(f,null,g(E.value,s=>(i(),N(P,{key:s.id,value:s.id},{default:u(()=>[o(te,{value:0},{default:u(()=>[o(y,{class:"flex overflow-x-auto space-x-4 pb-2"},{default:u(()=>[(i(!0),n(f,null,g(s.sub_categories,p=>(i(),N(b,{key:p.id,value:p.id},{default:u(()=>[T(r(p.name),1)]),_:2},1032,["value"]))),128))]),_:2},1024),o(ee,null,{default:u(()=>[(i(!0),n(f,null,g(s.sub_categories,p=>(i(),N(P,{key:p.id,value:p.id},{default:u(()=>[p.products.length>0?(i(),n("div",Ge,[t("div",Ke,[(i(!0),n(f,null,g(p.products,C=>(i(),n("div",{key:C.id,class:"col-span-12 lg:col-span-6 xl:col-span-3"},[t("div",Ye,[t("div",et,[t("img",{src:C.image?`/${C.image}`:"/image/image.png",alt:"Imagem do Produto",class:"w-full h-32 rounded-t-lg"},null,8,tt)]),t("div",st,[t("div",null,[t("div",at,r(C.name),1)])]),t("div",lt,[t("span",ot,"Preço: "+r(C.price)+" MT",1)]),t("button",{onClick:Rt=>de(C),class:"bg-blue-500 text-white px-4 py-2 rounded-full mt-1"}," Adicionar ",8,it)])]))),128))])])):(i(),n("div",nt,e[17]||(e[17]=[t("p",null,"No products available.",-1)])))]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})])])])])),o(k,{header:"Confirmação",visible:O.value,"onUpdate:visible":e[0]||(e[0]=s=>O.value=s),style:{width:"350px"},modal:!0},{footer:u(()=>[o(m,{label:"Não",icon:"pi pi-times",onClick:G,class:"p-button-text"}),o(m,{label:"Sim",icon:"pi pi-check",onClick:me,class:"p-button-text",autofocus:""})]),default:u(()=>[e[18]||(e[18]=t("div",{class:"flex align-items-center justify-content-center"},[t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),t("span",null,"Tem certeza que deseja proceder?")],-1))]),_:1},8,["visible"]),o(k,{header:"Open File",visible:Z.value,"onUpdate:visible":e[2]||(e[2]=s=>Z.value=s),style:{width:"30vw"}},{default:u(()=>[e[19]||(e[19]=t("p",null,"Here you can manage your files or perform specific actions.",-1)),o(m,{label:"Close",onClick:e[1]||(e[1]=s=>Z.value=!1)})]),_:1},8,["visible"]),o(k,{header:"Consumo da Mesa",visible:L.value,"onUpdate:visible":e[4]||(e[4]=s=>L.value=s),style:{width:"30vw"}},{default:u(()=>[t("div",rt,[e[21]||(e[21]=t("h3",{class:"text-lg font-bold mb-4"},"Detalhes do Pedido",-1)),t("ul",ut,[(i(!0),n(f,null,g(R.value,s=>(i(),n("li",{key:s.id,class:"flex justify-between border-b pb-2 mt-5"},[t("span",null,r(s.quantity)+" x "+r(s.product.name),1),t("span",null,[T("MZN "+r(s.total)+" ",1),t("i",{class:"pi pi-trash",onClick:p=>oe(s.id)},null,8,dt)])]))),128))]),t("p",ct,[e[20]||(e[20]=t("span",null,"Total: ",-1)),t("span",pt,"MZN "+r(M.value),1)]),t("div",vt,[o(m,{label:"Fechar",onClick:e[3]||(e[3]=s=>L.value=!1),class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded"})])])]),_:1},8,["visible"]),o(k,{header:"Confirmar Exclusão",visible:j.value,"onUpdate:visible":e[7]||(e[7]=s=>j.value=s),style:{width:"20vw"}},{default:u(()=>[t("div",mt,[e[22]||(e[22]=t("p",{class:"mb-4"},[T("Insira o código para confirmar a exclusão do item "),t("strong"),T(".")],-1)),je(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>A.value=s),type:"password",placeholder:"Código de confirmação",class:"w-full p-2 border rounded"},null,512),[[Pe,A.value]]),t("div",ft,[o(m,{label:"Cancelar",onClick:e[6]||(e[6]=s=>j.value=!1),class:"bg-gray-300 hover:bg-gray-400 text-black font-semibold px-4 py-2 rounded"}),o(m,{label:"Confirmar",onClick:ie,class:"bg-red-500 hover:bg-red-600 text-white font-semibold px-4 py-2 rounded"})])])]),_:1},8,["visible"]),o(k,{header:"Fechar a conta",visible:q.value,"onUpdate:visible":e[9]||(e[9]=s=>q.value=s),style:{width:"30vw"}},{default:u(()=>[t("div",bt,[e[24]||(e[24]=t("h3",{class:"text-lg font-bold mb-4"},"Detalhes do Pedido",-1)),t("ul",yt,[(i(!0),n(f,null,g(R.value,s=>(i(),n("li",{key:s.id,class:"flex justify-between border-b pb-2 mt-5"},[t("span",null,r(s.quantity)+" x "+r(s.product.name),1),t("span",null,"MZN "+r(s.total),1)]))),128))]),t("p",gt,[e[23]||(e[23]=t("span",null,"Total: ",-1)),t("span",_t,"MZN "+r(M.value),1)]),t("div",xt,[o(m,{label:"Fechar Conta",onClick:e[8]||(e[8]=s=>re()),class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded"})])])]),_:1},8,["visible"]),o(k,{header:"Fechar a conta",visible:z.value,"onUpdate:visible":e[12]||(e[12]=s=>z.value=s),style:{width:"30vw"}},{default:u(()=>[t("div",ht,[e[26]||(e[26]=t("h3",{class:"text-lg font-bold mb-4"},"Detalhes do Pedido",-1)),t("ul",wt,[(i(!0),n(f,null,g(R.value,s=>(i(),n("li",{key:s.id,class:"flex justify-between border-b pb-2 mt-5"},[t("span",null,r(s.quantity)+" x "+r(s.product.name),1),t("span",null,"MZN "+r(s.total),1)]))),128))]),o(ye,{modelValue:U.value,"onUpdate:modelValue":e[10]||(e[10]=s=>U.value=s),options:I.value,optionLabel:"name",optionValue:"id",class:"mt-2",placeholder:"Selecionar"},null,8,["modelValue","options"]),t("p",kt,[e[25]||(e[25]=t("span",null,"Total: ",-1)),t("span",Ct,"MZN "+r(M.value),1)]),t("div",Tt,[o(m,{label:"Pagar a Conta",onClick:e[11]||(e[11]=s=>ue()),class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded"})])])]),_:1},8,["visible"]),o(k,{visible:h.value,"onUpdate:visible":e[13]||(e[13]=s=>h.value=s),header:"Recibo",modal:!0,style:{width:"600px"},closable:!1},{footer:u(()=>[o(m,{label:"Imprimir",icon:"pi pi-print",onClick:pe}),o(m,{label:"Fechar",icon:"pi pi-times",class:"p-button-text",onClick:fe})]),default:u(()=>[x.value?(i(),n("iframe",{key:0,src:x.value,style:{width:"100%",height:"500px"},frameborder:"0"},null,8,Dt)):F("",!0)]),_:1},8,["visible"])],64)}}};export{Gt as default};
