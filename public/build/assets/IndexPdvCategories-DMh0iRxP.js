import{s as ge}from"./index-DPXoA4HO.js";import{s as _e}from"./index-DgFzkDdR.js";import{s as xe}from"./index-BORxrjYa.js";import{s as he,a as we,b as ke}from"./index-BaYdTfO0.js";import{s as Ce,a as Te}from"./index-C9R3Muz1.js";import{s as De}from"./index-COCScuMO.js";import{s as $e}from"./index-C4Pb4f0M.js";import{u as je,r as l,w as Se,o as Re,c as d,a as s,b as o,f as D,t as r,i as N,F as g,a5 as _,d as u,e as n,j as F,L as Me,aR as Ue,k as Ee}from"./app-DjjNWAyZ.js";import{d as Pe}from"./moment-CQ1ixRO1.js";import"./index-CsBO25G4.js";import"./index-B3ELJNnu.js";import"./index-BfKxmIB5.js";import"./index-D0L_gmj7.js";import"./index-DRQrLLY9.js";import"./index--CR5sDXX.js";import"./index-fpmgf2cM.js";import"./index-DwRIymzD.js";import"./index-BQ3oJh86.js";import"./index-D0iDJHK6.js";import"./index-BF6O7oxD.js";import"./index-Cr-WPBZi.js";const qe={key:0,class:"flex flex-col md:flex-row gap-12 min-h-screen items-center justify-center"},Be={class:"w-full"},Le={class:"flex flex-col gap-4 text-center"},Ne={key:1},Fe={class:"grid grid-cols-12 gap-4 h-screen"},Oe={class:"col-span-12 lg:col-span-3 h-full"},Ie={class:"card flex flex-col gap-4 h-full"},Ve={key:0},Ae=["onClick"],Ze={class:"flex justify-between mb-4"},Je={key:0,class:"mt-4"},We=["disabled"],ze={key:0,class:"flex flex-col gap-4 text-center"},He={class:"col-span-12 lg:col-span-9"},Qe={class:"mb-2"},Xe={class:"card flex flex-col gap-4"},Ge={key:0},Ke={class:"grid grid-cols-12 gap-8"},Ye={class:"card mb-0 bg-gray-100"},es={class:"mb-4"},ss=["src"],ts={class:"flex justify-between mb-2"},as={class:"text-surface-900 dark:text-surface-0 font-medium text-xl"},ls={class:"flex justify-between mb-2"},os={class:"text-primary font-medium"},ns={class:"flex justify-between mb-2"},is=["onClick"],rs={key:1},ds={class:"p-4"},us={class:"space-y-2"},cs=["onClick"],ps={class:"mt-4 text-lg font-semibold"},ms={class:"text-blue-500"},vs={class:"mt-4 flex justify-end"},fs={class:"p-4"},bs={class:"mt-4 flex justify-end space-x-2"},ys={class:"p-4"},gs={class:"space-y-2"},_s={class:"mt-4 text-lg font-semibold"},xs={class:"text-blue-500"},hs={class:"mt-4 flex justify-end"},ws={class:"p-4"},ks={class:"space-y-2"},Cs={class:"mt-4 text-lg font-semibold"},Ts={class:"text-blue-500"},Ds={class:"mt-4 flex justify-end"},$s=["src"],js="13579",Ks={__name:"IndexPdvCategories",setup(Ss){const x=Ee(),m=je();l(null);const E=l(!0),O=l(!1);let z=l(null);const H=l(""),P=l(null),se=l(1);l(15),l(0);const I=l(!1),q=l(null),$=l([]),j=l(0),S=l(0),f=l(!1),R=l([]),te=l(!1),M=l(1),V=l([]),Q=l(null),A=l(null),C=l(!1),h=l(null),Z=l(!1),B=l(!1),J=l(!1),L=l(!1),W=l(!1),U=l(!1),ae=[{label:"Consumo",items:[{label:"Ver consumo",icon:"pi pi-fw pi-folder-open",command:()=>{B.value=!0}},{label:"Imprimir Consumo",icon:"pi pi-fw pi-print",command:()=>{me()}}]},{label:"Conta",items:[{label:"Fechamento da Conta",icon:"pi pi-fw pi-lock",command:()=>{L.value=!0}},{label:"Finalizar da Conta",icon:"pi pi-fw pi-check",command:()=>{W.value=!0}}]}];function le(){x&&x.back()}const oe=a=>{Q.value=a,U.value=!0},ne=()=>{if(A.value!==js){m.add({severity:"error",summary:"Erro",detail:"Código de confirmação inválido",life:3e3});return}else axios.post(`/api/orderitem/${Q.value}`).then(a=>{P.value=a.data,S.value=a.data.total_consumed,q.value=a.data.categories,R.value=a.data.order_items,V.value=a.data.payment_methods,M.value=1,U.value=!1,m.add({severity:"success",summary:"Sucesso",detail:"Sucesso ao apagar",life:3e3})}).catch(a=>{m.add({severity:"error",summary:"Erro",detail:`${a}`,life:3e3})}).finally(()=>{})},X=()=>{I.value=!1};function ie(){const a={products:$.value.map(e=>({id:e.id,name:e.name,quantity:e.quantity,total:e.price*e.quantity})),total:j.value,table_id:x.currentRoute.value.params.id};f.value=!0,axios.post("/api/pdv",a,{headers:{"Content-Type":"multipart/form-data"},responseType:"blob"}).then(e=>{te.value=!1;const i=new Blob([e.data],{type:"application/pdf"});h.value=URL.createObjectURL(i),C.value=!0,J.value=!1,m.add({severity:"success",summary:"Successo",detail:"Produto encomedado sucesso!",life:3e3})}).catch(async e=>{var v,c;f.value=!1;let i="Ocorreu um erro inesperado.";if(e.response&&e.response.data instanceof Blob)try{const p=await e.response.data.text(),w=JSON.parse(p);i=w.message||w.error||i}catch(p){console.error("Erro ao processar o blob:",p)}else(c=(v=e.response)==null?void 0:v.data)!=null&&c.message&&(i=e.response.data.message);m.add({severity:"error",summary:"Erro",detail:i,life:3e3}),e.response.data.errors&&setErrors(e.response.data.errors)}).finally(()=>{f.value=!1})}function re(){f.value=!0,axios.get(`/api/pdv/closeaccount/${x.currentRoute.value.params.id}`,{responseType:"blob"}).then(a=>{const e=new Blob([a.data],{type:"application/pdf"});h.value=URL.createObjectURL(e),C.value=!0,L.value=!1,m.add({severity:"success",summary:"Successo",detail:"Encomenda fechada sucesso!",life:3e3})}).catch(async a=>{var i,v;f.value=!1;let e="Ocorreu um erro inesperado.";if(a.response&&a.response.data instanceof Blob)try{const c=await a.response.data.text(),p=JSON.parse(c);e=p.message||p.error||e}catch(c){console.error("Erro ao processar o blob:",c)}else(v=(i=a.response)==null?void 0:i.data)!=null&&v.message&&(e=a.response.data.message);m.add({severity:"error",summary:"Erro",detail:e,life:3e3}),a.response.data.errors&&setErrors(a.response.data.errors)}).finally(()=>{f.value=!1})}function de(){const a={payment_method_id:M.value,table_id:x.currentRoute.value.params.id};f.value=!0,axios.post("/api/payaccount",a,{headers:{"Content-Type":"multipart/form-data"},responseType:"blob"}).then(e=>{h.value&&URL.revokeObjectURL(h.value);const i=new Blob([e.data],{type:"application/pdf"});h.value=URL.createObjectURL(i),C.value=!0,J.value=!1,m.add({severity:"success",summary:"Successo",detail:"Encomenda fechada sucesso!",life:3e3})}).catch(async e=>{var v,c;console.log(e),f.value=!1;let i="Ocorreu um erro inesperado.";if(e.response&&e.response.data instanceof Blob)try{const p=await e.response.data.text(),w=JSON.parse(p);i=w.message||w.error||i}catch(p){console.error("Erro ao processar o blob:",p)}else(c=(v=e.response)==null?void 0:v.data)!=null&&c.message&&(i=e.response.data.message);m.add({severity:"error",summary:"Erro",detail:i,life:3e3}),e.response.data.errors&&setErrors(e.response.data.errors)}).finally(()=>{f.value=!1})}function ue(a){const e=$.value.find(v=>v.id===a.id),i=a.quantity_in_principal_stock??0;e?e.quantity<i&&(e.quantity+=1):i>0?$.value.push({...a,quantity:1}):m.add({severity:"error",summary:"Stock Insuficiente",detail:"Produto sem estoque disponível.",life:3e3}),G()}function ce(a){$.value.splice(a,1),G()}function G(){j.value=$.value.reduce((a,e)=>a+e.price*e.quantity,0)}function pe(){const a=document.querySelector("iframe");a&&(a.contentWindow.focus(),a.contentWindow.print())}function me(){axios.post(`/api/getreceipt/${x.currentRoute.value.params.id}`,{},{responseType:"blob"}).then(a=>{const e=new Blob([a.data],{type:"application/pdf"});h.value=URL.createObjectURL(e),C.value=!0,J.value=!1,m.add({severity:"success",summary:"Successo",detail:"Consumo Impresso com sucesso!",life:3e3})}).catch(async a=>{var i,v;E.value=!1,console.log(a),f.value=!1;let e="Ocorreu um erro inesperado.";if(a.response&&a.response.data instanceof Blob)try{const c=await a.response.data.text(),p=JSON.parse(c);e=p.message||p.error||e}catch(c){console.error("Erro ao processar o blob:",c)}else(v=(i=a.response)==null?void 0:i.data)!=null&&v.message&&(e=a.response.data.message);m.add({severity:"error",summary:"Erro",detail:e,life:3e3}),a.response.data.errors&&setErrors(a.response.data.errors)})}const K=async(a=1)=>{axios.get(`/api/pdv/${x.currentRoute.value.params.id}`,{params:{query:H.value}}).then(e=>{P.value=e.data,S.value=e.data.total_consumed,q.value=e.data.categories,R.value=e.data.order_items,V.value=e.data.payment_methods,M.value=1,E.value=!1}).catch(e=>{E.value=!1,m.add({severity:"error",summary:"Erro",detail:`${e.response.data.message}`,life:3e3}),le()})},ve=()=>{O.value=!0,axios.delete(`/api/tables/${z.value}`).then(()=>{P.value.data=P.value.data.filter(a=>a.id!==z.value),X(),m.add({severity:"success",summary:"Sucesso",detail:"Sucesso ao apagar",life:3e3})}).catch(a=>{m.add({severity:"error",summary:"Erro",detail:`${a}`,life:3e3}),O.value=!1}).finally(()=>{O.value=!1})};function fe(){C.value=!0,x.back()}const be=Pe(()=>{K(se.value)},300);return Se(H,be),Re(()=>{K()}),(a,e)=>{const i=$e,v=De,c=we,p=ke,w=Ce,Y=Te,ee=he,y=xe,T=_e,ye=ge;return n(),d(g,null,[E.value?(n(),d("div",qe,[s("div",Be,[s("div",Le,[o(i,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"}),e[14]||(e[14]=s("p",null,"Por Favor Aguarde...",-1))])])])):(n(),d("div",Ne,[s("div",Fe,[s("div",Oe,[s("div",Ie,[s("h2",null,[e[15]||(e[15]=D("Resumo da venda ")),j.value>0?(n(),d("div",Ve,[s("strong",null,"Total: "+r(j.value)+" MT",1)])):N("",!0)]),(n(!0),d(g,null,_($.value,(t,b)=>(n(),d("div",{key:b,class:"card bg-gray-100 p-4"},[s("div",null,[s("strong",null,r(t.name),1),s("button",{onClick:k=>ce(b),class:"rounded-full bg-red-100",style:{width:"2.5rem",height:"2.5rem"}},"X",8,Ae)]),s("div",Ze,[s("div",null,r(t.quantity)+" x "+r(t.price)+" MT",1),s("div",null,r(t.price*t.quantity)+" MT",1)])]))),128)),j.value>0?(n(),d("div",Je,[s("strong",null,"Total: "+r(j.value)+" MT",1),s("button",{disabled:f.value,onClick:ie,class:"bg-blue-500 text-white px-4 py-2 rounded-full mt-1",style:{width:"100%"}},e[16]||(e[16]=[D("Adicionar a conta"),s("i",{class:"pi pi-print"},null,-1)]),8,We),f.value?(n(),d("div",ze,[o(i,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"})])):N("",!0)])):N("",!0)])]),s("div",He,[s("div",Qe,[o(v,{model:ae},{end:u(()=>[s("p",null,"Total Consumo: "+r(S.value)+" MT",1)]),_:1})]),s("div",Xe,[o(ee,{value:1},{default:u(()=>[o(p,{class:"flex overflow-x-auto space-x-4 pb-2"},{default:u(()=>[(n(!0),d(g,null,_(q.value,t=>(n(),F(c,{key:t.id,value:t.id},{default:u(()=>[D(r(t.name),1)]),_:2},1032,["value"]))),128))]),_:1}),o(Y,null,{default:u(()=>[(n(!0),d(g,null,_(q.value,t=>(n(),F(w,{key:t.id,value:t.id},{default:u(()=>[o(ee,{value:0},{default:u(()=>[o(p,{class:"flex overflow-x-auto space-x-4 pb-2"},{default:u(()=>[(n(!0),d(g,null,_(t.sub_categories,b=>(n(),F(c,{key:b.id,value:b.id},{default:u(()=>[D(r(b.name),1)]),_:2},1032,["value"]))),128))]),_:2},1024),o(Y,null,{default:u(()=>[(n(!0),d(g,null,_(t.sub_categories,b=>(n(),F(w,{key:b.id,value:b.id},{default:u(()=>[b.products.length>0?(n(),d("div",Ge,[s("div",Ke,[(n(!0),d(g,null,_(b.products,k=>(n(),d("div",{key:k.id,class:"col-span-12 lg:col-span-6 xl:col-span-3"},[s("div",Ye,[s("div",es,[s("img",{src:k.image?`/${k.image}`:"/image/image.png",alt:"Imagem do Produto",class:"w-full h-32 rounded-t-lg"},null,8,ss)]),s("div",ts,[s("div",as,r(k.name),1)]),s("div",ls,[s("span",os,"Preço: "+r(k.price)+" MT",1)]),s("div",ns,[s("small",null,"Stock:"+r(k.quantity_in_principal_stock),1)]),s("button",{onClick:Rs=>ue(k),class:"bg-blue-500 text-white px-4 py-2 rounded-full mt-1"}," Adicionar ",8,is)])]))),128))])])):(n(),d("div",rs,e[17]||(e[17]=[s("p",null,"No products available.",-1)])))]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})])])])])),o(T,{header:"Confirmação",visible:I.value,"onUpdate:visible":e[0]||(e[0]=t=>I.value=t),style:{width:"350px"},modal:!0},{footer:u(()=>[o(y,{label:"Não",icon:"pi pi-times",onClick:X,class:"p-button-text"}),o(y,{label:"Sim",icon:"pi pi-check",onClick:ve,class:"p-button-text",autofocus:""})]),default:u(()=>[e[18]||(e[18]=s("div",{class:"flex align-items-center justify-content-center"},[s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),s("span",null,"Tem certeza que deseja proceder?")],-1))]),_:1},8,["visible"]),o(T,{header:"Open File",visible:Z.value,"onUpdate:visible":e[2]||(e[2]=t=>Z.value=t),style:{width:"30vw"}},{default:u(()=>[e[19]||(e[19]=s("p",null,"Here you can manage your files or perform specific actions.",-1)),o(y,{label:"Close",onClick:e[1]||(e[1]=t=>Z.value=!1)})]),_:1},8,["visible"]),o(T,{header:"Consumo da Mesa",visible:B.value,"onUpdate:visible":e[4]||(e[4]=t=>B.value=t),style:{width:"30vw"}},{default:u(()=>[s("div",ds,[e[21]||(e[21]=s("h3",{class:"text-lg font-bold mb-4"},"Detalhes do Pedido",-1)),s("ul",us,[(n(!0),d(g,null,_(R.value,t=>(n(),d("li",{key:t.id,class:"flex justify-between border-b pb-2 mt-5"},[s("span",null,r(t.quantity)+" x "+r(t.product.name),1),s("span",null,[D("MZN "+r(t.total)+" ",1),s("i",{class:"pi pi-trash",onClick:b=>oe(t.id)},null,8,cs)])]))),128))]),s("p",ps,[e[20]||(e[20]=s("span",null,"Total: ",-1)),s("span",ms,"MZN "+r(S.value),1)]),s("div",vs,[o(y,{label:"Fechar",onClick:e[3]||(e[3]=t=>B.value=!1),class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded"})])])]),_:1},8,["visible"]),o(T,{header:"Confirmar Exclusão",visible:U.value,"onUpdate:visible":e[7]||(e[7]=t=>U.value=t),style:{width:"20vw"}},{default:u(()=>[s("div",fs,[e[22]||(e[22]=s("p",{class:"mb-4"},[D("Insira o código para confirmar a exclusão do item "),s("strong"),D(".")],-1)),Me(s("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>A.value=t),type:"password",placeholder:"Código de confirmação",class:"w-full p-2 border rounded"},null,512),[[Ue,A.value]]),s("div",bs,[o(y,{label:"Cancelar",onClick:e[6]||(e[6]=t=>U.value=!1),class:"bg-gray-300 hover:bg-gray-400 text-black font-semibold px-4 py-2 rounded"}),o(y,{label:"Confirmar",onClick:ne,class:"bg-red-500 hover:bg-red-600 text-white font-semibold px-4 py-2 rounded"})])])]),_:1},8,["visible"]),o(T,{header:"Fechar a conta",visible:L.value,"onUpdate:visible":e[9]||(e[9]=t=>L.value=t),style:{width:"30vw"}},{default:u(()=>[s("div",ys,[e[24]||(e[24]=s("h3",{class:"text-lg font-bold mb-4"},"Detalhes do Pedido",-1)),s("ul",gs,[(n(!0),d(g,null,_(R.value,t=>(n(),d("li",{key:t.id,class:"flex justify-between border-b pb-2 mt-5"},[s("span",null,r(t.quantity)+" x "+r(t.product.name),1),s("span",null,"MZN "+r(t.total),1)]))),128))]),s("p",_s,[e[23]||(e[23]=s("span",null,"Total: ",-1)),s("span",xs,"MZN "+r(S.value),1)]),s("div",hs,[o(y,{label:"Fechar Conta",onClick:e[8]||(e[8]=t=>re()),class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded"})])])]),_:1},8,["visible"]),o(T,{header:"Fechar a conta",visible:W.value,"onUpdate:visible":e[12]||(e[12]=t=>W.value=t),style:{width:"30vw"}},{default:u(()=>[s("div",ws,[e[26]||(e[26]=s("h3",{class:"text-lg font-bold mb-4"},"Detalhes do Pedido",-1)),s("ul",ks,[(n(!0),d(g,null,_(R.value,t=>(n(),d("li",{key:t.id,class:"flex justify-between border-b pb-2 mt-5"},[s("span",null,r(t.quantity)+" x "+r(t.product.name),1),s("span",null,"MZN "+r(t.total),1)]))),128))]),o(ye,{modelValue:M.value,"onUpdate:modelValue":e[10]||(e[10]=t=>M.value=t),options:V.value,optionLabel:"name",optionValue:"id",class:"mt-2",placeholder:"Selecionar"},null,8,["modelValue","options"]),s("p",Cs,[e[25]||(e[25]=s("span",null,"Total: ",-1)),s("span",Ts,"MZN "+r(S.value),1)]),s("div",Ds,[o(y,{label:"Pagar a Conta",onClick:e[11]||(e[11]=t=>de()),class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded"})])])]),_:1},8,["visible"]),o(T,{visible:C.value,"onUpdate:visible":e[13]||(e[13]=t=>C.value=t),header:"Recibo",modal:!0,style:{width:"600px"},closable:!1},{footer:u(()=>[o(y,{label:"Imprimir",icon:"pi pi-print",onClick:pe}),o(y,{label:"Fechar",icon:"pi pi-times",class:"p-button-text",onClick:fe})]),default:u(()=>[h.value?(n(),d("iframe",{key:0,src:h.value,style:{width:"100%",height:"500px"},frameborder:"0"},null,8,$s)):N("",!0)]),_:1},8,["visible"])],64)}}};export{Ks as default};
